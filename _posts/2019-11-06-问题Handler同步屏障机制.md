---
layout: post
title: 问题(Handler同步屏障机制)
---

* 1 同步屏障机制就是插入一个同步屏障信息到Looper的队列头部，当Looper调用next获取信息时候，发现队列头部是一个同步屏障信息，就会跳过所有同步消息，寻找为异步的消息执行  

* 2.为什么要这样呢  
 用于实时  
 因为屏幕刷新是每16ms一次  
 假如队列信息是这样  
 a                       b                          刷新  
 200ms           120ms   
 这样这个刷新信息要经过320ms才能执行，相等于丢了20帧  
  
 而用同步屏障，刷新消息会先执行，执行完成后，再执行a和b  
   
 刷新消息是由接收到系统的VSYNC信号才刷新的，VSYNC信号是需要手动注册的  
 常见当我们调用requestLayout或者postFrameCallBack都会请求监听下一次的VSYNC信号，所以app并不是因为每隔16ms都会刷新一次，而是我们主动监听下一次的VSYNC信号，得到系统通知才会刷新  
  
所以在a和b的这段时间内，假如我们没有请求监听，那么a和b会顺序执行，否则会再次进行同步屏障，先执行刷新信息  
  
但是同步屏障的时机是Queue的next方法，所以假如某个耗时方法正在执行的话，会需要等待这个耗时方法执行完成后，才能开启同步屏障。  

